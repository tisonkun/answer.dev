"use strict";(self.webpackChunkanswer=self.webpackChunkanswer||[]).push([[5166],{9613:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>g});var i=t(9496);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=i.createContext({}),u=function(e){var n=i.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},s=function(e){var n=u(e.components);return i.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},d=i.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=u(t),g=o,m=d["".concat(p,".").concat(g)]||d[g]||c[g]||r;return t?i.createElement(m,a(a({ref:n},s),{},{components:t})):i.createElement(m,a({ref:n},s))}));function g(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,a=new Array(r);a[0]=d;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var u=2;u<r;u++)a[u]=t[u];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6841:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>a,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var i=t(4250),o=(t(9496),t(9613));const r={sidebar_position:1},a="Plugin",l={unversionedId:"development/extending/README",id:"development/extending/README",title:"Plugin",description:"When we need to do some extensions to Answer's functionality, for example, OAuth login, we design a way to use plugins to implement these functions.",source:"@site/docs/development/extending/README.md",sourceDirName:"development/extending",slug:"/development/extending/",permalink:"/docs/development/extending/",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"settings",permalink:"/docs/recipes/dashboard/settings"},next:{title:"Plugin Configuration Schema",permalink:"/docs/development/extending/plugin_config"}},p={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Official Plugins",id:"official-plugins",level:3},{value:"Plugin Type",id:"plugin-type",level:3},{value:"Build",id:"build",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Command",id:"command",level:3},{value:"Third-party plugin",id:"third-party-plugin",level:2},{value:"Use",id:"use",level:2},{value:"Upgrade",id:"upgrade",level:2},{value:"Develop",id:"develop",level:2},{value:"Backend Development",id:"backend-development",level:3},{value:"Implement the base",id:"implement-the-base",level:4},{value:"Implement the function interface",id:"implement-the-function-interface",level:4},{value:"Implement the configuration interface",id:"implement-the-configuration-interface",level:4},{value:"Register initialization function",id:"register-initialization-function",level:4},{value:"Debugging tips",id:"debugging-tips",level:4},{value:"Contributing",id:"contributing",level:2},{value:"Design &amp; Principle",id:"design--principle",level:2}],s={toc:u};function c(e){let{components:n,...r}=e;return(0,o.kt)("wrapper",(0,i.Z)({},s,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"plugin"},"Plugin"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"When we need to do some extensions to Answer's functionality, for example, OAuth login, we design a way to use plugins to implement these functions. ")),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("h3",{id:"official-plugins"},"Official Plugins"),(0,o.kt)("p",null,"You can find a list of officially supported plugins for Answer ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/answerdev/plugins"},"here"),"."),(0,o.kt)("h3",{id:"plugin-type"},"Plugin Type"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"We classify plugins into different types.\nDifferent types of plugins have different functions.\nPlugins of the same type have the same effect, but are implemented differently.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Connector: The Connector plugin helps us to implement third-party login functionality. e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"GitHub OAuth Login")),(0,o.kt)("li",{parentName:"ul"},"Storage: The Storage plugin helps us to upload files to third-party storage. (preview)"),(0,o.kt)("li",{parentName:"ul"},"Cache: Support for using different caching middleware. e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"Redis")," (preview)"),(0,o.kt)("li",{parentName:"ul"},"Filter: Filter out illegal questions or answers. (coming soon)"),(0,o.kt)("li",{parentName:"ul"},"Render: Parsers for different content formats. (coming soon)"),(0,o.kt)("li",{parentName:"ul"},"Finder: Support for using search engines to speed up the search for question answers. (coming soon)")),(0,o.kt)("h2",{id:"build"},"Build"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Answer binary supports packaging different required plugins into the binary.")),(0,o.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Original Answer binary"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://go.dev/"},"Golang")," ",(0,o.kt)("inlineCode",{parentName:"li"},">=1.18"))),(0,o.kt)("h3",{id:"command"},"Command"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"We use the ",(0,o.kt)("inlineCode",{parentName:"p"},"build")," command provided with the Answer binary to rebuild a version of Answer with the plugin.")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"For example, let's see how to build an Answer binary that includes the github third-party login plugin")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"# answer build --with [plugin@plugin_version=[replacement]] --output [file]\n$ ./answer build --with github.com/answerdev/plugins/connector/github\n\n# build a new answer with github login plugin then output to ./new_answer.\n$ ./answer build --with github.com/answerdev/plugins/connector/github@1.0.0 --output ./new_answer\n\n# with multiple plugins\n$ ./answer build \\\n--with github.com/answerdev/plugins/connector/github \\\n--with github.com/answerdev/plugins/connector/google\n\n# with local plugins\n$ ./answer build --with github.com/answerdev/plugins/connector/github@1.0.0=/my-local-space\n\n# cross compilation. Build a linux-amd64 binary in macos\n$ CGO_ENABLED=0 GOOS=linux GOARCH=amd64 ./answer build --with github.com/answerdev/plugins/connector/github\n")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"plugin")," command to list the current binary containing plugins.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ ./new_answer plugin\n\n# output\n# github connector[0.0.1] made by answerdev\n# google connector[0.0.1] made by answerdev\n")),(0,o.kt)("h2",{id:"third-party-plugin"},"Third-party plugin"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"We recommend the use of ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/answerdev/plugins"},"official plugins"),", if you want to use third-party plugins, refer to the following.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If the third-party plugin is publicly available, you can build with it like official plugins."),(0,o.kt)("li",{parentName:"ul"},"If the third-party plugin is private, you need to download it then build with.")),(0,o.kt)("h2",{id:"use"},"Use"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The answer with the plug-in version is used in the same way as before.\nYou can find the plugin's configuration in the admin page.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"plugin-config-admin-page",src:t(3154).Z,width:"2688",height:"980"})),(0,o.kt)("h2",{id:"upgrade"},"Upgrade"),(0,o.kt)("p",null,"You just need to recompile and use the latest version of the plugin."),(0,o.kt)("h2",{id:"develop"},"Develop"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Viewing the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/answerdev/plugins"},"official plugin")," code will make you to quickly understand and learn plugin development.")),(0,o.kt)("h3",{id:"backend-development"},"Backend Development"),(0,o.kt)("h4",{id:"implement-the-base"},"Implement the base"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Base")," interface contains basic information about the plugin and is used to display.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// Info presents the plugin information\ntype Info struct {\n    Name        Translator\n    SlugName    string\n    Description Translator\n    Author      string\n    Version     string\n    Link        string\n}\n\n// Base is the base plugin\ntype Base interface {\n    // Info returns the plugin information\n    Info() Info\n}\n")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"SlugName")," of the plugin must be unique. Two plugins with the same ",(0,o.kt)("inlineCode",{parentName:"p"},"SlugName")," will panic when registering.")),(0,o.kt)("h4",{id:"implement-the-function-interface"},"Implement the function interface"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Different plugin types require different interfaces of implementation."),(0,o.kt)("p",{parentName:"admonition"},"For example, following is the ",(0,o.kt)("inlineCode",{parentName:"p"},"Connector")," plugin interface. ")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"type Connector interface {\n    Base\n    \n    // ConnectorLogoSVG presents the logo in svg format\n    ConnectorLogoSVG() string\n    \n    // ConnectorName presents the name of the connector\n    // e.g. Facebook, Twitter, Instagram\n    ConnectorName() Translator\n    \n    // ConnectorSlugName presents the slug name of the connector\n    // Please use lowercase and hyphen as the separator\n    // e.g. facebook, twitter, instagram\n    ConnectorSlugName() string\n    \n    // ConnectorSender presents the sender of the connector\n    // It handles the start endpoint of the connector\n    // receiverURL is the whole URL of the receiver\n    ConnectorSender(ctx *GinContext, receiverURL string) (redirectURL string)\n    \n    // ConnectorReceiver presents the receiver of the connector\n    // It handles the callback endpoint of the connector, and returns the\n    ConnectorReceiver(ctx *GinContext, receiverURL string) (userInfo ExternalLoginUserInfo, err error)\n}\n")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"Translator")," is a struct for translation. Please refer to ",(0,o.kt)("a",{parentName:"p",href:"/docs/development/extending/plugin_translation"},"the documentation")," for details.")),(0,o.kt)("h4",{id:"implement-the-configuration-interface"},"Implement the configuration interface"),(0,o.kt)("p",null,"For details on the description of each configuration item, please refer to ",(0,o.kt)("a",{parentName:"p",href:"/docs/development/extending/plugin_config"},"the documentation"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"type Config interface {\n    Base\n\n    // ConfigFields returns the list of config fields\n    ConfigFields() []ConfigField\n\n    // ConfigReceiver receives the config data, it calls when the config is saved or initialized.\n    // We recommend to unmarshal the data to a struct, and then use the struct to do something.\n    // The config is encoded in JSON format.\n    // It depends on the definition of ConfigFields.\n    ConfigReceiver(config []byte) error\n}\n")),(0,o.kt)("h4",{id:"register-initialization-function"},"Register initialization function"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'import "github.com/answerdev/answer/plugin"\n\nfunc init() {\n    plugin.Register(&GitHubConnector{\n        Config: &GitHubConnectorConfig{},\n    })\n}\n')),(0,o.kt)("h4",{id:"debugging-tips"},"Debugging tips"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"During the development and debugging phase, you can use the following tips to avoid repetitive packaging.")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Use answer source code for development."),(0,o.kt)("li",{parentName:"ol"},"Write your plugin directly in the plugin directory."),(0,o.kt)("li",{parentName:"ol"},"Import your plugin in the main function")),(0,o.kt)("p",null,"After that you just need to start the answer project normally and it will contain the plugins you developed."),(0,o.kt)("h2",{id:"contributing"},"Contributing"),(0,o.kt)("p",null,"For plugin types that have not been implemented yet, please wait for the official implementation to be completed before contributing.\nFor existing plugin types, you can follow the steps below to contribute the plugin implementation to us. "),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Submit an issue request to ensure that the official is not developing the same plug-in as you."),(0,o.kt)("li",{parentName:"ol"},"Get confirmation that you can develop your plugin, test it and submit a PR."),(0,o.kt)("li",{parentName:"ol"},"Wait for the PR merge, the official will include your plugin.")),(0,o.kt)("h2",{id:"design--principle"},"Design & Principle"),(0,o.kt)("p",null,"Since Golang is a static language, there is no friendly plugin mechanism. So instead of a dynamic approach, we use recompilation for deployment."))}c.isMDXComponent=!0},3154:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/plugin-config-admin-page-e343b33766f45a10093fc621e741c811.png"}}]);